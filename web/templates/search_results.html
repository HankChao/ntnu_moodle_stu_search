<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœå°‹çµæœ - å¸«å¤§å­¸ç”Ÿè³‡æ–™æœå°‹ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .student-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }
        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }
        .search-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .badge-custom {
            font-size: 0.8em;
            margin-right: 5px;
        }
        .highlight {
            background-color: #cce6ff;
            color: #003366;
            font-weight: bold;
            border-radius: 3px;
            padding: 0 2px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">ğŸ“ å¸«å¤§å­¸ç”Ÿè³‡æ–™æœå°‹ç³»çµ±</h1>
        
        <!-- æœå°‹è¡¨å–® -->
        <div class="search-form">
            <form method="POST" action="/search">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="search_term" class="form-label">é—œéµå­—æœå°‹ï¼ˆå§“åæˆ–å­¸è™Ÿï¼‰</label>
                        <input type="text" class="form-control" id="search_term" name="search_term" 
                               placeholder="è«‹è¼¸å…¥å§“åæˆ–å­¸è™Ÿ" value="{{ search_params.search_term }}">
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="education" class="form-label">å­¸åˆ¶</label>
                        <select class="form-select" id="education" name="education">
                            <option value="">å…¨éƒ¨</option>
                            {% for edu in filter_options.educations %}
                            <option value="{{ edu }}" {{ 'selected' if search_params.education == edu else '' }}>{{ edu }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label for="admission_year" class="form-label">å…¥å­¸å¹´åº¦</label>
                        <input type="text" class="form-control" id="admission_year" name="admission_year" placeholder="{{ filter_options.admission_year_placeholder }}" value="{{ search_params.admission_year }}">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="college" class="form-label">å­¸é™¢</label>
                        <select class="form-select" id="college" name="college">
                            <option value="">å…¨éƒ¨</option>
                            {% for col in filter_options.colleges %}
                            <option value="{{ col }}" {{ 'selected' if search_params.college == col else '' }}>{{ col }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="department" class="form-label">ç³»æ‰€</label>
                        <select class="form-select" id="department" name="department">
                            <option value="">å…¨éƒ¨</option>
                            {% for dept in filter_options.departments %}
                            <option value="{{ dept }}" {{ 'selected' if search_params.department == dept else '' }}>{{ dept }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="text-center">
                    <button type="submit" class="btn btn-primary btn-lg">ğŸ” æœå°‹</button>
                    <a href="/" class="btn btn-secondary btn-lg ms-2">ğŸ  å›é¦–é </a>
                </div>
            </form>
        </div>
        
        <!-- æœå°‹çµæœçµ±è¨ˆ -->
        <div class="alert alert-success">
            <strong>æœå°‹çµæœï¼š</strong>æ‰¾åˆ° {{ result_count }} ç­†ç¬¦åˆæ¢ä»¶çš„å­¸ç”Ÿè³‡æ–™
            {% set suspicious_count = students | selectattr('is_suspicious', 'equalto', true) | list | length %}
            {% if suspicious_count > 0 %}
            <br><small class="text-warning">âš ï¸ å…¶ä¸­ {{ suspicious_count }} ç­†ç‚ºç–‘ä¼¼å•é¡Œè³‡æ–™</small>
            {% endif %}
            {% if search_params.search_term %}
            <br><small>é—œéµå­—ï¼š{{ search_params.search_term }}</small>
            {% endif %}
        </div>
        
        <!-- å­¸ç”Ÿåˆ—è¡¨ -->
        {% if students %}
        <div class="row">
            {% for student in students %}
            <div class="col-md-6 col-lg-4">
                <div class="student-card">
                    <div class="d-flex align-items-center mb-2">
                        <img src="{{ student.avatar_url }}" alt="é ­åƒ" class="avatar me-3" 
                             onerror="this.src='https://via.placeholder.com/60x60?text=No+Image'">
                        <div>
                            <h6 class="mb-1">
                                {% if search_params.search_term and search_params.search_term in student.name %}
                                {{ student.name | replace(search_params.search_term, '<span class="highlight">' ~ search_params.search_term ~ '</span>', 1) | safe }}
                                {% else %}
                                {{ student.name }}
                                {% endif %}
                                {% if student.is_suspicious %}
                                <span class="badge bg-warning text-dark ms-1" title="ç–‘ä¼¼å•é¡Œï¼š{{ student.suspicious_reasons|join(', ') }}">âš ï¸ ç–‘ä¼¼</span>
                                {% endif %}
                            </h6>
                            <small class="text-muted">ID: {{ student.id }}</small>
                        </div>
                    </div>
                    
                    {% if student.student_id %}
                    <div class="mb-2">
                        <span class="badge bg-primary badge-custom">
                            {% if search_params.search_term and search_params.search_term in student.student_id %}
                            {{ student.student_id | replace(search_params.search_term, '<span class="highlight">' ~ search_params.search_term ~ '</span>', 1) | safe }}
                            {% else %}
                            {{ student.student_id }}
                            {% endif %}
                        </span>
                        <span class="badge bg-success badge-custom">{{ student.education }}</span>
                    </div>
                    
                    <div class="small text-muted">
                        <div>ğŸ“… å…¥å­¸ï¼šæ°‘åœ‹{{ student.admission_year }}å¹´</div>
                        <div>ğŸ« {{ student.college_name.split('/')[1] if '/' in student.college_name else student.college_name }}</div>
                        <div>ğŸ“š {{ student.department_name.split('/')[1] if '/' in student.department_name else student.department_name }}</div>
                        {% if student.class_code and student.class_code != '0/ä¸åˆ†ç­' %}
                        <div>ğŸ‘¥ ç­ç´šï¼š{{ student.class_code }}</div>
                        {% endif %}
                    </div>
                    {% else %}
                    <span class="badge bg-warning">ç„¡å­¸è™Ÿè³‡è¨Š</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-warning text-center">
            <h4>ğŸ˜• æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„å­¸ç”Ÿè³‡æ–™</h4>
            <p>è«‹å˜—è©¦èª¿æ•´æœå°‹æ¢ä»¶</p>
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
